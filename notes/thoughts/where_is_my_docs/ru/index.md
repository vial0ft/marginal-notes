# Где моя документация, чувак?

![В поиске документации](https://i.kym-cdn.com/entries/icons/original/000/019/277/confusedtravolta.jpg)

> Disclaimer: 
> Персонажи, компания, ситуация, названия брендов, ~~смысл жизни?~~ - выдуманы.
> Любые совпадения скорее всего абсолютно случайны.

## Итак...
Наверняка у вас не раз была такая ситуация, когда вы только-только устроились на новое место работы и начинаете погружаться в новое окружение. Неважно сколько у вас лет опыта - год, три года, пять лет или это ваша первая работа: вы - новичок здесь, и многое вокруг для вас в новинку. Разумеется чем больше у вас опыта, тем больше знакомых элементов нового окружения вы видите: таск-трекер, дейлики, иерархия управления, коллеги со знакомыми вам названиями ролей, инструментарий и подходы к разработке - вы всё это уже видели (и не раз). Но всё-таки призрак новизны витает в воздухе и нужно его поймать и прогнать - нужно погрузиться в контекст процессов и решений для этого конкретного проекта и системы, в которой проект создаётся. 
Ведь чем быстрее будет произведён экзорцизм по изгнанию вашего персонального призрака новизны, тем быстрее вы начнёте приносить ***ТО САМОЕ***, чего ждут, как маны небесной, название которого как священную матру из священных писаний по управлению персоналом менеджеры повторяют и повторяют день за днём, чтобы это название въелось в подсознание и осталось там навсегда - **business value**. Проще говоря - *пользу* для компании.
В этом заинтересованы все, и вы - в первую очередь, чтобы продолжить находиться на вновь приобретённой должности и возможно даже подняться выше. Согласны?  
Вы начинаете проходить процесс адаптации, где ваши коллеги рассказывают вам о проекте - где что находится и что за что отвечает:

 "Вот тут у нас слой презентации, вот тут у нас слой работы с бд, вот тут бизнес-логика... Этот микросервис делает то-то, этот другое... вот тут кафка, вот редис... Вот схема как это *примерно* связано друг с другом, она *немного не актуальна*, но по сути верная... А вот здесь вся документация о системе...."

И перед вами открывается страница корпоративной системы *crowdfluence* ("Спасибо, что не *Lotion*" - думаете вы) с порядком пятидесяти разделов с подразделами с подразделами, где самое последнее изменение было полгода назад...

"Хотя бы здесь ЕСТЬ документация..." - думаете вы, остерегаясь задать себе следующие вопросы: 
- "Сколько времени уйдёт на чтение и понимание?"
- "Поможет ли это в том, чтобы быстрее начать быть полезным?"

И, поразмыслив немножко (и, возможно, даже пробежавшись глазами по разделам), решаете, что разберётесь по ходу работы... 

Проходит где-то месяц вашей работы в проекте. Вы начали понимать как работают некоторые части системы, но далеко не всё - проект достаточно большой, и его логика не без труда даётся для постижения. 

И вот однажды на планёрке вам поручают задачу разобраться с новым багом. Это достаточно неприятный баг, но он не настолько критичный, чтобы кто-то из старожил отложил все свои дела по новым фичам или починкой горячих багов с прода и разобрался с ним. Его поручают вам.

Вы тратите день-два на исследование, которое, к сожалению, не даёт вам ответа на вопрос "В чём *причина* такого поведения?". Вы поискали по ключевым словам в документации проекта описание программных модулей, в которых (как вы предполагаете) содержится причина бага. Так же поискали описание доменных сущностей, которые описаны в документации. 

Вы часами медитировали над кодом, перескакивая между файлами по местам вызовов методов, в надежде получить озарение. Код блестяще написан и вылизан - видно, что люди его писавшие старались придерживаться хороших практик и держать уровень качества. Тесты есть - их много, и показатели покрытия кода тестами крайне высоки. Каждый модуль, каждая публичная функция (и даже приватные) снабжён описанием. У вас есть тонны и тонны информации, сообщающей "**что** тот или иной модуль делает", но к сожалению вы не понимаете "**почему** они так реализованы".   

После этого вы решаете осаждать коллег вопросами, о том "с чем может быть связано такое поведение системы?" и "почему сейчас такая реализация?". Ведь мало найти место, где система *отклоняется от ожидаемого* - ещё нужно понять *как правильно вернуть систему на "рельсы нормального поведения", не сломав ничего в процессе исправления*.

Один из коллег, рассказывает вам, что помнит как "что-то такое *связанное* с этой проблемой когда-то обсуждалось, и Фёдор К. чинил что-то подобное, но он уже давно уволился. Вот *ссылка* на задачу. Можно взять контекст из обсуждения..."

Вы переходите по ссылке и видите *это*:

![Контекст](../resources/context.png)
Знакомо?

Изучив обсуждение, вы понимаете, что фикс данного бага был временным решением, чтобы закрыть ошибку, возникшую в результате получения данных из сервиса, с которым была интеграция. Вы даже натыкались на изменения, связанные с этим багом, и IDE показывала их. 

Но откуда вам было знать, временное решение должно было быть убрано, когда внешний начнёт присылать данные ожидаемым путём?

Ниоткуда, и вот почему:
- Вас не было здесь, когда производилась интеграция с внешним сервисом
- Вас не было здесь, когда проблема возникла
- Вас не было здесь, когда она обсуждалась и исправлялась

Короче говоря - у вас абсолютно не было **контекста** произошедшего. В результате чего, исправление бага превращается в детективное расследование (где, как известно, главное - не выйти на самих себя)

Документация, несмотря на всю свою полноту и многословность, описывает достаточно общо работу системы не отражает таких вещей, как временное решение. А зачастую и многое из постоянного.
## Что есть документация?
> Автор под документацией подразумевает вообще все знания о системе: технические, нетехнические, архитектурные, бизнесовые, и т.д. 

**Документация** - это **непротиворечивый**, **актуальный на текущий момент**  документ или набор документов предоставляющие знания о проекте:
- Идея проекта, цели и задачи, которые проект решает (зачем этот проект?) - это raison d'être[^1] выстраиваемой системы.
- Требования к проекту (какие ограничения у проекта?)
- План развития проекта (как будут достигнуты цели проекта?)
Эти знания должны быть продуманы и описаны изначально.

И прежде, чем вы успеете сказать, что waterfall мёртв и показал свою неэффективность и что сегодня правит бал agile...

Описанное выше это необходимая, но недостаточная незыблемая часть для **ДОЛГОСРОЧНОГО** и **КОМПЛЕКСНОГО** проекта: если она меняется, то проект должен завершиться и начаться новый (возможно заимствуя что-то из текущего) - соответсвующий новым идее и задачам или новым требованиям.
В противном случае может оказаться, что [Бурдж-Халиф](https://ru.wikipedia.org/wiki/%D0%91%D1%83%D1%80%D0%B4%D0%B6-%D0%A5%D0%B0%D0%BB%D0%B8%D1%84%D0%B0) только что назначили скромным семейным кафе и уже собираются менять фундамент, на котором он стоит.
Детали о том "как" и "что" будет делаться для соответствия целям и требованиям проектной системы в рамках плана развития могут дополняться, корректироваться, **если не идёт в разрез с основой**.
Более того - новые детали **ДОЛЖНЫ** найти своё место в документации.
"Насколько подробно?", спросите вы. В идеальном варианте, чтобы документация была отражением работающей на текущий момент системы без дополнительного стороннего контекста для читателя. Это вероятно могут быть разные документы. Однако, *в любой момент времени необходимо иметь доступное и прозрачное для понимания описание поведения системы и причины такого поведения*.

Цель документирования - быть проводником ***знания*** о работе системы, и отражать её текущее состояние - пресловутый **контекст** - а не быть ***просто информацией*** описывающей систему.

[^1]: Смысл существования (fr.)

## Где живёт контекст?
> Словом *контекст* в рамках статьи автор называет знания о работе системы, в том числе о причинах такой работы

Согласно (исключительно субъективной, не претендующей на истину в последней инстанции) статистике, *контекст* можно найти:
- в ~~базе знаний~~ сборнике информации, где сконцентрировано описание основных элементов или "движущихся" частей системы (на момент полугодовой давности, вероятно);
- в таск-трекере, с описанием (в рамках задач, подзадач и задач на задачи) фич, инцидентов (иногда со ссылками на сборник информации), распределением задач по сотрудникам и временем их выполнения, а также с комментариями к задачам;
- в мессенджерах, где также активно проходят обсуждения задач, размазывая ответ на вопрос "что и как должно быть сделано?" на сотни и сотни сообщений в разных группах;
- в системе контроля версий - где можно найти кто, когда что-то добавил\удалил\изменил и в связи с какой задачей в таск-трекере это произошло (но почему потребовались эти изменения?);
- в системах управления репозиторием - где иногда в добавок к списку изменений можно так же найти обсуждения в рамках  код-ревью решения, короткое описание того, что было сделано (но опять же почему?), а так же иногда комментарии в рамках код-ревью;
- в коде, где у вас есть полное описание того **как** выстроена логика исполнения на данный момент (но без данных с прода... но без реальной инфраструктуры... но опять же без ответа на вопрос "**почему** система сделана именно так?");
- в тестах (у вас ведь есть ВСЕ ТЕСТЫ на ВЕСЬ функционал?);
- в почте, где по крайней мере раньше обсуждались решения, особенно с внешними агентами компании (удачи получить рабочую переписку, Фёдора К.);
- на митингах и созвонах (они ведь записываются? Записываются ведь?);
- в головах у коллег (отложите, пожалуйста, пилу хирурга... и попробуйте найти Фёдора К.);

Учитывая всё вышеперечисленное попробуйте ответить на вопрос:
"Сколько действий вам нужно сделать, чтобы погрузиться в контекст решаемой задачи?"

Даже при самом благоприятной картине, чтобы ответить на вопрос: "**почему** система работает так как она сейчас работает и как она **должна** работать?" вам, будучи разработчиком: 
Необходимо в системе контроля версий найди коммит -> по коммиту найти задачу -> по номеру задачи найти описание задачи в таск-трекере -> в таск-трекере найти ссылку на документацию -> пройти по ссылке в раздел документации, и *может быть* там вы увидите ответ на вопрос "**почему** так и как должно быть на самом деле?"
## Ложка дёгтя...
...которую в и без того нерадостную картину в наши дни добавляет "прогресс". Когда-то кому-то в голову пришла гениальная идея генерировать документацию (как впрочем и тесты) на основе текущей кодовой базы, упустив мысль о том, что описание системы (документация) является **причиной** появления реализации (исполняемого кода), а **не следствием**. И если уж говорить на чистоту, то термин "**исходный** код" (в данном случае акцент на слово "исходный") больше подходит к документации нежели к реализации. В защиту данного утверждения в этот "курино-яичный" вопрос (помимо логики), можно привести то, что даже при самом тщательном и пристальным взглядом исполняемый код мало что может рассказать о причинах своего появления. Здесь автор хотел бы передать привет, сторонникам идеи "самодокументируемого кода".
## Ложка мёда...
Беглое исследование по поиску решения проблемы, связанной с поддержанием документации системы в актуальном состоянии, может подсветить несколько интересных инструментов и подходов, созданных, чтобы разбавить нынешний бульон из текущего положения дел. 
Одной из таких идей является [docs-as-code](https://www.writethedocs.org/guide/docs-as-code/), когда *документация изменяется в той же мере и таким же образом, как и исполняемый программный код*, реализующий идеи заложенные в документацию. Что, кажется, можно зачесть как подтверждение если не массовости, то как минимум озабоченности группы людей обозначенной проблемой.
## Место для шага вперёд
Как можно развить идею документации, меняющейся в процессе разработки, с сохранением её актуальности, полноты, по возможности прозрачности, с минимальными накладными расходами?

Чтобы попытаться найти ответ на этот вопрос, стоит сначала проанализировать "общепринятый" подход практикуемый в разработке:
1. Возникает идея или потребность добавить новый функционал в систему;
2. Собирается группа людей (стек холдеры, аналитики, архитекторы, менеджеры....) и они прорабатывают эту идею за несколько встреч;
3. По итогам этой встречи получается **документ**, который общо описывает вИдение того, что должно получится;
4. Создаётся задача в таск-трекере (с типом story, epic, или epic story, или вообще legend heroic epic story), с описанием того **что** нужно сделать и **зачем**, а также прикладывается имеющийся **документ**;
5. Далее аналитик совместно менеджером и командой разработки обсуждает **описание идеи** на предмет **полноты**, **понятности** и **непротиворечивости по отношению к текущей системе**, для дальнейшей реализации и добавления описанного функционала. (в процесс обсуждения постоянно пытается вклиниться скрам-мастер, которому очень интересно узнать "сколько стори поинтов займёт разработка того или иного функционала и почему так много");
6. Ленендарно-героическо-эпическая-история декомпозируется на менее ~~легендарные~~ объёмные задачи и распределяется между участниками команды разработки;
7. Функционал реализуется, тесты на новый функционал пишутся, собирается релиз;
8. Релиз обкатывается на тестовом стенде, демонстрируется на предпродовом стенде;
9. Находятся недоработки, которые фиксятся (задача в таск-трекере, линковка с эпиком и текущим релизом и т.д.) дальше всё повторяется с пункта (7) пока функционал не будет достаточно хорош, чтобы его выпустили к реальным пользователям;
10. Ленендарно-героическо-эпическая-история заканчивается;
11. Возможно появляются новые записи в сборнике информации (но это не точно);
12. Цикл повторяется сначала...

В написанной последовательности процесса, намеренно опущены многие шаги - в противном случае это напоминало бы размашистый ясень [Иггдрасиль](https://ru.wikipedia.org/wiki/%D0%98%D0%B3%D0%B3%D0%B4%D1%80%D0%B0%D1%81%D0%B8%D0%BB%D1%8C), держащий все девять миров.

Вы наверняка очень внимательны, и заметили, что в описанном процессе у команды разработки был момент, когда они в одно и то же время в одном и том же месте разделяли один и тот же **контекст** созданный на основе **документа**, но, к сожалению, потом этот контекст распался на множество мелких контекстов в разных местах и потерял связь первоисточником. А в конечном итоге, была постфактум сделана запись в сборник информации, которая примерно никак не позволит человеку понять "как и почему так работает система" без дополнительного расследования.

А почему бы не изменить процесс и не вносить изменения в систему вместе с документацией, с оглядкой на подход docs-as-code? 
В этом случае описание функционала или его изменение получается неразрывно связано с самим функционалом:
- "бесплатно" функционал и описание синхронизировано, в том числе во времени за счёт системы контроля версий;
- нет необходимости шариться по сотням мест, чтобы собрать весь **необходимый и достаточный** контекст - вот он здесь рядом с самими изменениями;
- документацию можно при желании собрать в единый документ, который будет отражать текущее поведение системы;
- "бесплатно" появляется ещё один уровень валидации: внёс изменения в работу системы - опиши их. Ведь что-то же изменилось, иначе в чём суть работы? (это почти как тесты, но написанные обычными словами);

"Бесплатно" - в данном случае умышленно поставлено в кавычки и, вероятно, нужно ещё обособить это слово множеством больших знаков вопроса. Знаков вопроса как к самой идее концептуально, так и вопросов касающихся реализации идеи на практике. Потому что, как известно, "бесплатного" ничего не бывает.
Если плюсы такого подхода перечислены - а при желании можно найти больше плюсов и даже более весомых, чем описанных выше. То каковы минусы?
Какова же плата? И чем придётся жертвовать?
На ум приходит ещё одна мантра - **TTM** (time to market). Ведь *в моменте* необходимо дополнительно тратить время на преобразование контекста задачи в **знание о системе** - в **документацию**. Однако это принесёт свои плоды в долгосрочной перспективе. Она ведь есть у компании, в которой вы работаете?
